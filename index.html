<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<title>родрооро┐ро┤рпН AI Chatbot + Email</title>
<style>
body { font-family: Arial; background:#111; color:#fff; text-align:center; }
#chat { width: 80%; max-width: 600px; margin:20px auto; background:#222; padding:15px; border-radius:10px; }
.msg { margin:10px; padding:10px; border-radius:6px; }
.user { background:#444; text-align:right; }
.bot { background:#2a2a6a; text-align:left; white-space: pre-line; }
.sources { font-size:12px; color:#aaa; margin-top:5px; }
input { padding:8px; border-radius:5px; border:none; }
button { padding:8px 15px; border-radius:5px; border:none; background:#4caf50; color:white; cursor:pointer; }
</style>
</head>
<body>
<h1>ЁЯТм родрооро┐ро┤рпН AI Chatbot</h1>
<div id="chat"></div>
<input id="q" type="text" placeholder="роЙроЩрпНроХро│рпН роХрпЗро│рпНро╡ро┐ропрпИ роЗроЩрпНроХрпЗ type роЪрпЖропрпНропро╡рпБроорпН..." style="width:70%">
<button onclick="ask()">роХрпЗро│рпН</button>

<!-- Hidden Netlify Form -->
<form name="user-questions" netlify netlify-honeypot="bot-field" hidden>
  <input type="text" name="question" id="hiddenQuestion">
</form>

<script>
// тЬЕ Local variable answers
const localAnswers = {
  "ро╡рогроХрпНроХроорпН": "ро╡рогроХрпНроХроорпН! роОрокрпНрокроЯро┐ роЗро░рпБроХрпНроХро┐ро▒рпАро░рпНроХро│рпН?",
  "роЙройрпН рокрпЖропро░рпН роОройрпНрой": "роОройрпН рокрпЖропро░рпН родрооро┐ро┤рпН Cyber Zone AI ЁЯдЦ",
  "car": "Car роОройрпНрокродрпБ роТро░рпБ ро╡ро╛роХройроорпН ЁЯЪЧ"
};

// Voice output
function speak(text){
  if('speechSynthesis' in window){
    const utter = new SpeechSynthesisUtterance(text.replace(/<br>/g,' '));
    const voices = window.speechSynthesis.getVoices();
    const tamilVoice = voices.find(v=>v.lang.startsWith('ta')) || voices[0];
    if(tamilVoice) utter.voice = tamilVoice;
    window.speechSynthesis.speak(utter);
  }
}

// Email send (via Netlify form)
function sendToEmail(userInput){
  document.getElementById("hiddenQuestion").value = userInput;
  document.forms["user-questions"].submit();
}

async function ask(){
  const q = document.getElementById("q").value.trim();
  if(!q) return;
  addMsg("user", q);
  document.getElementById("q").value = "";

  let finalAnswer = "";
  let sources = [];
  let moreLinks = [];

  // 1я╕ПтГг Local variable
  if(localAnswers[q]){
    finalAnswer = localAnswers[q];
    sources.push("Local Variable");
    addMsg("bot", finalAnswer + sourceText());
    speak(finalAnswer);
    return;
  } else {
    // If not in local vars тЖТ send to email
    sendToEmail(q);
  }

  // 2я╕ПтГг Wikipedia
  try{
    let wiki = await fetch(`https://ta.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`);
    if(wiki.ok){
      let j = await wiki.json();
      if(j.extract){
        finalAnswer += "ЁЯУЦ Wikipedia: " + j.extract + "\n\n";
        sources.push("Wikipedia");
        moreLinks.push(j.content_urls?.desktop?.page);
      }
    }
  }catch(e){console.error(e);}

  // 3я╕ПтГг DuckDuckGo
  try{
    let ddg = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(q)}&format=json&no_redirect=1&no_html=1`);
    if(ddg.ok){
      let j = await ddg.json();
      if(j.AbstractText){
        finalAnswer += "ЁЯФО DuckDuckGo: " + j.AbstractText + "\n\n";
        sources.push("DuckDuckGo");
        if(j.AbstractURL) moreLinks.push(j.AbstractURL);
      }
    }
  }catch(e){console.error(e);}

  // 4я╕ПтГг OpenLibrary
  try{
    let ol = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(q)}`);
    if(ol.ok){
      let j = await ol.json();
      if(j.docs && j.docs.length>0){
        finalAnswer += "ЁЯУЪ OpenLibrary: " + j.docs[0].title + "\n\n";
        sources.push("OpenLibrary");
        moreLinks.push("https://openlibrary.org" + j.docs[0].key);
      }
    }
  }catch(e){console.error(e);}

  // 5я╕ПтГг Fallback
  if(!finalAnswer) finalAnswer = "рооройрпНройро┐роХрпНроХро╡рпБроорпН, рокродро┐ро▓рпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ.";

  addMsg("bot", finalAnswer + sourceText());
  speak(finalAnswer.replace(/ЁЯУЦ|ЁЯФО|ЁЯУЪ/g,""));

  function sourceText(){
    return sources.length ? `<div class='sources'>роорпВро▓роорпН: ${sources.join(", ")}<br>роорпЗро▓рпБроорпН рокро╛ро░рпНроХрпНроХ: ${moreLinks.map(l=>`<a href="${l}" target="_blank">${l}</a>`).join(", ")}</div>` : "";
  }
}

function addMsg(type, text){
  let div = document.createElement("div");
  div.className = "msg " + type;
  div.innerHTML = text;
  document.getElementById("chat").appendChild(div);
  document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
}
</script>
</body>
</html>
